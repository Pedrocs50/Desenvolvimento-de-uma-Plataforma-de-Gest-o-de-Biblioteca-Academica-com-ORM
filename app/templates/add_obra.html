{% extends 'base.html' %}

{% block header %}
    <h1 class="text-3xl font-bold tracking-tight text-gray-900">Adicionar Nova Obra</h1>
{% endblock %}

{% block content %}
<div class="bg-white p-8 rounded-lg shadow-md max-w-2xl mx-auto">
    <form action="{{ url_for('main.add_obra') }}" method="POST">
        <div class="space-y-6">
            
            <div class="grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
                <div class="sm:col-span-4">
                    <label for="tipo_obra" class="block text-sm font-medium leading-6 text-gray-900">Tipo de Obra</label>
                    <select id="tipo_obra" name="tipo_obra" required class="mt-2 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm">
                        <option value="livro">Livro</option>
                        <option value="tese">Tese</option>
                        <option value="dissertacao">Dissertação</option>
                    </select>
                </div>

                <div class="sm:col-span-2">
                    <label for="quantidade_exemplares" class="block text-sm font-medium leading-6 text-gray-900">Qtd. de Exemplares</label>
                    <input type="number" name="quantidade_exemplares" id="quantidade_exemplares" value="1" min="1" required class="mt-2 block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                </div>
            </div>

            <div>
                <label for="titulo" class="block text-sm font-medium leading-6 text-gray-900">Título</label>
                <div class="mt-2">
                    <input type="text" name="titulo" id="titulo" required class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm">
                </div>
            </div>
            
            <div class="grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-2">
                <div>
                    <label for="ano_publicacao" class="block text-sm font-medium leading-6 text-gray-900">Ano de Publicação</label>
                    <div class="mt-2">
                        <input type="number" name="ano_publicacao" id="ano_publicacao" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm">
                    </div>
                </div>
                <div>
                    <label for="genero" class="block text-sm font-medium leading-6 text-gray-900">Gênero</label>
                    <div class="mt-2">
                        <input type="text" name="genero" id="genero" placeholder="Ex: Fantasia, Ficção" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm">
                    </div>
                </div>
            </div>

            <div id="campos_livro">
                <div class="mt-6">
                    <label for="isbn" class="block text-sm font-medium leading-6 text-gray-900">ISBN</label>
                    <div class="mt-2">
                        <input type="text" name="isbn" id="isbn" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm">
                    </div>
                </div>
                <div class="mt-6">
                    <label for="editora" class="block text-sm font-medium leading-6 text-gray-900">Editora</label>
                    <div class="mt-2">
                        <input type="text" name="editora" id="editora" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm">
                    </div>
                </div>
            </div>

            <div id="campos_tese" style="display: none;">
                <div class="mt-6">
                    <label for="programa_pos" class="block text-sm font-medium leading-6 text-gray-900">Programa de Pós-Graduação</label>
                    <div class="mt-2">
                        <input type="text" name="programa_pos" id="programa_pos" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm">
                    </div>
                </div>
                <div class="mt-6">
                    <label for="orientador" class="block text-sm font-medium leading-6 text-gray-900">Orientador</label>
                    <div class="mt-2">
                        <input type="text" name="orientador" id="orientador" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm">
                    </div>
                </div>
            </div>

            <div class="border-t border-gray-200 pt-6">
                <label for="autor_id" class="block text-sm font-medium leading-6 text-gray-900">Selecione um Autor Existente</label>
                <div class="mt-2">
                    <select id="autor_id" name="autor_id" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm">
                        <option value="">Nenhum (usar o campo abaixo)</option>
                        {% for autor in autores %}
                        <option value="{{ autor.id }}">{{ autor.nome }}</option>
                        {% endfor %}
                    </select>
                </div>
                <p class="mt-4 text-sm text-center text-gray-500">ou</p>
                <label for="novo_autor_nome" class="mt-4 block text-sm font-medium leading-6 text-gray-900">Adicione um Novo Autor</label>
                <div class="mt-2">
                    <input type="text" name="novo_autor_nome" id="novo_autor_nome" placeholder="Ex: Machado de Assis" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm">
                </div>
            </div>
        </div>

        <div class="mt-8 flex items-center justify-end gap-x-6">
            <a href="{{ url_for('main.listar_obras_admin') }}" class="text-sm font-semibold leading-6 text-gray-900">Cancelar</a>
            <button type="submit" class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">Salvar Obra</button>
        </div>
    </form>
</div>

<script>
    document.getElementById('tipo_obra').addEventListener('change', function () {
        var tipo = this.value;
        var camposLivro = document.getElementById('campos_livro');
        var camposTese = document.getElementById('campos_tese');
        
        camposLivro.style.display = 'none';
        camposTese.style.display = 'none';
        
        if (tipo === 'livro') {
            camposLivro.style.display = 'block';
        } else if (tipo === 'tese' || tipo === 'dissertacao') {
            camposTese.style.display = 'block';
        }
    });
    document.getElementById('tipo_obra').dispatchEvent(new Event('change'));
</script>
{% endblock %}